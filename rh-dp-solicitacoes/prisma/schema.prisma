generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Attachment {
  id             String       @id
  solicitationId String
  filename       String
  url            String
  mimeType       String
  sizeBytes      Int
  createdAt      DateTime     @default(now())
  solicitation   Solicitation @relation(fields: [solicitationId], references: [id])
}

model Comment {
  id             String       @id
  solicitationId String
  autorId        String
  texto          String
  createdAt      DateTime     @default(now())
  autor          User         @relation("CommentAutor", fields: [autorId], references: [id])
  solicitation   Solicitation @relation(fields: [solicitationId], references: [id])
}

model Event {
  id             String       @id
  solicitationId String
  actorId        String
  tipo           String
  createdAt      DateTime     @default(now())
  actor          User         @relation("EventActor", fields: [actorId], references: [id])
  solicitation   Solicitation @relation(fields: [solicitationId], references: [id])
}

model TipoSolicitacao {
  id           String         @id
  nome         String         @unique
  descricao    String?
  schemaJson   Json
  createdAt    DateTime       @default(now())
  updatedAt    DateTime
  solicitacoes Solicitation[]
}

model Solicitation {
  id            String          @id
  titulo        String
  descricao     String
  setorDestino  Setor
  status        Status          @default(ABERTA)
  autorId       String
  responsavelId String?
  tipoId        String
  payload       Json
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  anexos        Attachment[]
  comentarios   Comment[]
  eventos       Event[]
  autor         User            @relation("SolicitationAutor", fields: [autorId], references: [id])
  responsavel   User?           @relation("SolicitationResponsavel", fields: [responsavelId], references: [id])
  tipo          TipoSolicitacao @relation(fields: [tipoId], references: [id])
}

model User {
  id         String     @id @default(dbgenerated("(gen_random_uuid())::text"))
  email      String     @unique
  fullName   String
  login      String?    @unique(map: "user_login_key")
  phone      String?
  costCenter String?
  status     UserStatus @default(ATIVO)
  role       Role       @default(COLABORADOR)
  // ðŸ‘ˆ ADICIONE ESTA LINHA
  authId     String?    @db.Uuid
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt

  solicitacoesCriadas   Solicitation[] @relation("SolicitationAutor")
  solicitacoesAssumidas Solicitation[] @relation("SolicitationResponsavel")
  comments              Comment[]      @relation("CommentAutor")
  events                Event[]        @relation("EventActor")

  @@map("User")
}


enum Role {
  COLABORADOR
  RH
  DP
  ADMIN
}

enum Setor {
  RH
  DP
}

enum Status {
  ABERTA
  EM_ANALISE
  AGUARDANDO_INFO
  APROVADA
  REJEITADA
  CONCLUIDA
}

enum UserStatus {
  ATIVO
  INATIVO
}
