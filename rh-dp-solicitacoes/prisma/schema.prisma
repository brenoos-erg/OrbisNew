// -------- DATASOURCE / GENERATOR (deixe como já está no seu arquivo) --------
// datasource db { provider = "postgresql"; url = env("DATABASE_URL") }
// generator client { provider = "prisma-client-js" }

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// -------- Enums existentes (mantenha) --------
enum Role {
  COLABORADOR
  RH
  DP
  ADMIN
}

enum Status {
  ABERTA
  EM_ANALISE
  AGUARDANDO_INFO
  APROVADA
  REJEITADA
  CONCLUIDA
}

enum Setor {
  RH
  DP
}

// -------- NOVO enum para status de usuário --------
enum UserStatus {
  ATIVO
  INATIVO
}

// -------- USER (corrigido e com os novos campos) --------
model User {
  id                String     @id @default(uuid()) @db.Uuid
  authId            String?    @unique @db.Uuid // vínculo com auth.users (Supabase)
  // cadastro
  login             String     @unique // ex.: b.sousa
  fullName          String
  email             String     @unique
  phone             String? // número de telefone
  costCenter        String? // centro de custo
  status            UserStatus @default(ATIVO) // controle de acesso
  passwordExpiresAt DateTime? // expiração da senha
  // housekeeping
  createdAt         DateTime   @default(now())
  updatedAt         DateTime   @updatedAt

  // relações
  solicitacoesCriadas   Solicitation[] @relation("Autor")
  solicitacoesAssumidas Solicitation[] @relation("Responsavel")
  comentarios           Comment[]
  eventos               Event[]
}

// -------- RESTANTE (ajuste nos FKs para @db.Uuid onde aponta para User.id) --------
model TipoSolicitacao {
  id           String         @id @default(cuid())
  nome         String         @unique
  descricao    String?
  schemaJson   Json
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  solicitacoes Solicitation[]
}

model Solicitation {
  id            String          @id @default(cuid())
  titulo        String
  descricao     String
  setorDestino  Setor
  status        Status          @default(ABERTA)
  autorId       String          @db.Uuid
  autor         User            @relation("Autor", fields: [autorId], references: [id])
  responsavelId String?         @db.Uuid
  responsavel   User?           @relation("Responsavel", fields: [responsavelId], references: [id])
  tipoId        String
  tipo          TipoSolicitacao @relation(fields: [tipoId], references: [id])
  payload       Json
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  comentarios   Comment[]
  anexos        Attachment[]
  eventos       Event[]
}

model Comment {
  id             String       @id @default(cuid())
  solicitationId String
  solicitation   Solicitation @relation(fields: [solicitationId], references: [id])
  autorId        String       @db.Uuid
  autor          User         @relation(fields: [autorId], references: [id])
  texto          String
  createdAt      DateTime     @default(now())
}

model Attachment {
  id             String       @id @default(cuid())
  solicitationId String
  solicitation   Solicitation @relation(fields: [solicitationId], references: [id])
  filename       String
  url            String
  mimeType       String
  sizeBytes      Int
  createdAt      DateTime     @default(now())
}

model Event {
  id             String       @id @default(cuid())
  solicitationId String
  solicitation   Solicitation @relation(fields: [solicitationId], references: [id])
  actorId        String       @db.Uuid
  actor          User         @relation(fields: [actorId], references: [id])
  tipo           String
  createdAt      DateTime     @default(now())
}
